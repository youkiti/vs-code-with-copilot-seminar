# 4. AIツールの使い方

このセクションでは、GitHub Copilotを使って効率的にコードを書く方法を学びます。

## 目標

- GitHub Copilotの基本的な使い方の理解
- AIによるコード補完の活用方法の習得
- コードの品質管理とデバッグ手法の習得

## 4.1 GitHub Copilotの基本

### コード補完の基本

1. コメントを書いて意図を伝える
```R
# 年齢が20歳以上のデータを抽出する
```

2. Copilotが提案するコードを確認
```R
data %>%
    filter(age >= 20)
```

3. Tab キーで提案を受け入れる

### 効果的なプロンプトの書き方

良い例：
```R
# 年齢（age）と身長（height）の散布図を作成し、
# 性別（sex）で色分けする
```

悪い例：
```R
# グラフを作る
```

## 4.2 エラー対処とトラブルシューティング

### Copilotを活用したエラー解決

1. エラーメッセージをコメントとして記述
```R
# Error: object 'data' not found が発生
# データの読み込みと前処理方法を提案してください
```

2. エラーの原因と解決策をCopilotが提案
```R
# データの読み込みが必要です
data <- read.csv("your_data.csv")

# データの存在確認
if(exists("data")) {
    print("データが正常に読み込まれました")
} else {
    print("データの読み込みに失敗しました")
}
```

### エラーメッセージの活用

1. エラーメッセージをそのままコメントとして記述
```R
# Error in filter(data, age >= 20) : 
#   could not find function "filter"
```

2. Copilotが必要なパッケージの読み込みを提案
```R
# dplyrパッケージの読み込みが必要です
library(dplyr)

# その後でfilter関数を使用
data %>%
    filter(age >= 20)
```

## 4.3 コードの流れを設計する

### コメントによる設計の提案

1. 大まかな流れをコメントで記述
```R
# 1. データの読み込み
# 2. 欠損値の確認と処理
# 3. 基本統計量の算出
# 4. グラフの作成
```

2. Copilotが各ステップのコードを提案
```R
# 1. データの読み込み
data <- read.csv("data.csv")

# 2. 欠損値の確認と処理
summary(data)
data_clean <- na.omit(data)

# 3. 基本統計量の算出
data_summary <- data_clean %>%
    group_by(group) %>%
    summarise(
        mean = mean(value),
        sd = sd(value)
    )

# 4. グラフの作成
ggplot(data_clean, aes(x = group, y = value)) +
    geom_boxplot()
```

### 段階的な実装

1. 処理の概要をコメントで記述
```R
# 高血圧研究の解析手順：
# 1. 患者データの読み込み
# 2. 血圧値の異常値チェック
# 3. 年齢層による層別解析
# 4. 結果の可視化
```

2. 各ステップの詳細をコメントで追加
```R
# 1. 患者データの読み込み
# - CSVファイルから読み込み
# - 列名の確認
# - データ型の確認

# 2. 血圧値の異常値チェック
# - 基準値の設定（収縮期血圧: 60-250 mmHg）
# - 異常値の除外
# - 除外前後のデータ数の確認

# 3. 年齢層による層別解析
# - 年齢層の定義（若年、中年、高年）
# - 層別の記述統計
# - 層別の血圧分布

# 4. 結果の可視化
# - 年齢層別の箱ひげ図
# - 血圧分布のヒストグラム
# - 層別の要約統計表
```

## 4.4 実践的な使用方法

### データ前処理での活用

```R
# 以下のデータクリーニングを行う：
# 1. 欠損値の除去
# 2. 年齢が0-100の範囲内のデータのみ抽出
# 3. BMIを計算（体重(kg) / 身長(m)^2）
```

### 統計解析での活用

```R
# 以下の統計解析を実行：
# 1. 年齢と身長の相関係数を計算
# 2. 性別ごとの年齢の平均値と標準偏差を算出
# 3. 2群間のt検定を実施
```

### データ可視化での活用

```R
# 以下のグラフを作成：
# 1. 年齢のヒストグラム
# 2. 性別ごとの箱ひげ図
# 3. 散布図にトレンドラインを追加
```

## 4.3 コードの品質管理

### コードの品質とは？

プログラムは動けばよいというわけではありません。以下の3つの観点が大切です：

1. **読みやすさ**（他の人が理解できるか）
   - 例えば、料理のレシピと同じです
   - 手順が分かりやすく書かれているか
   - 必要な材料（変数）の名前が適切か

2. **効率性**（無駄な処理がないか）
   - 例えば、文房具の整理と同じです
   - 必要なものがすぐに取り出せるか
   - 使わないものが場所を取っていないか

3. **信頼性**（安全に動くか）
   - 例えば、自転車の点検と同じです
   - 異常な状況でも安全に止まれるか
   - 定期的なメンテナンスができるか

### よいコードと悪いコードの例

#### 悪いコード例：
```R
# 変数名が分かりにくい
x <- 25
y <- 170.5
z <- x + y

# エラーチェックがない
result <- data$value / 0  # ゼロ除算の可能性

# 無駄な処理
for(i in 1:1000) {
    print(i)  # 必要のない出力
}
```

#### よいコード例：
```R
# 分かりやすい変数名
age <- 25
height <- 170.5
total <- age + height

# エラーチェックあり
if(denominator != 0) {
    result <- numerator / denominator
} else {
    print("ゼロでは割れません")
}

# 効率的な処理
summary_data <- data %>%
    group_by(group) %>%
    summarise(
        mean_value = mean(value),
        count = n()
    )
```

### コードをチェックする方法

#### 1. コードの見た目をチェック
- インデント（字下げ）は揃っているか
  ```R
  # 悪い例
  if(age >= 20){
  print("成人です")
      print("投票できます")
    }

  # よい例
  if(age >= 20) {
      print("成人です")
      print("投票できます")
  }
  ```

#### 2. 変数名をチェック
- 何を表す変数か分かるような名前になっているか
  ```R
  # 悪い例
  a <- 25
  b <- "Tokyo"
  
  # よい例
  age <- 25
  city <- "Tokyo"
  ```

#### 3. コメントをチェック
- 複雑な処理には説明があるか
  ```R
  # 悪い例
  result <- x * 1.1
  
  # よい例
  # 消費税（10%）を加算
  price_with_tax <- price * 1.1
  ```

### 問題が起きたときの対処方法

#### 1. エラーメッセージを読む
```R
# エラーの例
Error in read.csv("data.csv") : ファイルが見つかりません

# 対処方法
# 1. ファイル名は合っているか確認
# 2. ファイルの場所は合っているか確認
# 3. ファイルは存在するか確認
```

#### 2. 途中経過を確認する
```R
# データの中身を確認
print("データを読み込みました：")
head(data)  # 最初の6行を表示

print("計算結果：")
print(result)  # 計算結果を表示
```

#### 3. 段階的に確認する
```R
# 1. データの読み込み確認
data <- read.csv("data.csv")
print("Step 1: データ読み込み完了")

# 2. 前処理の確認
clean_data <- na.omit(data)
print("Step 2: 欠損値除去完了")
print(paste("行数:", nrow(clean_data)))

# 3. 計算の確認
result <- mean(clean_data$value)
print("Step 3: 平均値計算完了")
print(paste("平均値:", result))
```

### 実践的なチェックリスト

コードを書いた後、以下の項目を確認しましょう：

- [ ] 変数名は分かりやすいか
- [ ] 必要なコメントは書いてあるか
- [ ] インデントは揃っているか
- [ ] エラーチェックは入れてあるか
- [ ] 無駄な処理はないか
- [ ] テストはしたか

このチェックリストは、自転車の点検表のようなものです。
一つずつ確認することで、安全で効率的なコードを書くことができます。

### Copilot Chatを使ったコードレビュー

コードの品質チェックは、AIに手伝ってもらうこともできます。
以下の手順で、Copilot Chatにコードレビューを依頼できます：

1. **Copilot Chatの起動**
   - VS Codeの左側にある「GitHub Copilot」アイコン（チャットのような形）をクリック
   - または `Ctrl + Shift + i` （Macの場合は `Cmd + Shift + i`）を押す

2. **コードの選択**
   - レビューしてほしいコードを選択
   - 例えば以下のようなコード：
     ```R
     # データの前処理
     x<-read.csv("data.csv")
     for(i in 1:nrow(x)){
     if(x$age[i]>20){
     x$category[i]="adult"
     }else{x$category[i]="minor"}
     }
     result=mean(x$value)
     print(result)
     ```

3. **レビューの依頼**
   - 選択したコードを右クリック
   - メニューから「Copilot」→「Start Code Review」を選択
   - または、チャットで直接「このコードをレビューして改善点を提案してください」と入力

4. **AIからの提案**
   Copilot Chatは以下のような改善点を提案してくれます：
   ```R
   # 改善後のコード
   # データの前処理
   data <- read.csv("data.csv")  # 分かりやすい変数名に変更
   
   # dplyrを使用してより効率的に処理
   library(dplyr)
   result <- data %>%
       mutate(
           category = if_else(age > 20, "adult", "minor")
       ) %>%
       summarise(
           mean_value = mean(value)
       )
   
   print(result$mean_value)
   ```

5. **リファクタリングの依頼**
   - 選択したコードを右クリック
   - メニューから「Copilot」→「Fix This」を選択
   - または、チャットで「このコードをリファクタリングしてください」と入力
   - より具体的に「dplyrを使って効率的に書き直してください」といった指示も可能

6. **提案の適用**
   - Copilotが提案したコードを確認
   - 良さそうな提案があれば「Accept」をクリック
   - または提案されたコードをコピー＆ペースト

### リファクタリングのコツ

Copilot Chatには、以下のような具体的な依頼ができます：

1. **コードの整理**
   ```
   このコードをより読みやすく整理してください：
   - 適切なインデントを入れる
   - 変数名を分かりやすくする
   - 必要なコメントを追加する
   ```

2. **効率化**
   ```
   このコードをより効率的に書き直してください：
   - dplyrパッケージを使用する
   - 不要なループを除去する
   - データ処理を最適化する
   ```

3. **エラー対策**
   ```
   このコードにエラー処理を追加してください：
   - ファイルの存在確認
   - 欠損値のチェック
   - 異常値の処理
   ```

このように、Copilot Chatを使うことで、コードの品質を効率的に改善できます。
AIの提案を参考にしながら、より良いコードを書く練習をしましょう。

## 4.4 効率的な開発フロー

### コーディングの基本ステップ

1. 要件の整理
   - 目的の明確化
   - 必要なデータの特定
   - 期待される結果の定義

2. コードの実装
   - コメントで処理内容を記述
   - Copilotの提案を活用
   - 段階的に実装

3. テストと改善
   - 動作確認
   - コードの最適化
   - ドキュメント化

## チェックポイント

以下の項目を確認してください：

- [ ] GitHub Copilotの基本的な使い方を理解している
- [ ] 効果的なプロンプトが書ける
- [ ] コードの品質管理ができる
- [ ] デバッグ手法を理解している
- [ ] 効率的な開発フローを実践できる

## 演習問題

1. サンプルデータを使って、Copilotの支援を受けながらデータ分析を行ってみましょう
2. 自分で書いたコードをレビューし、改善点を見つけてみましょう
3. エラーが発生した場合のデバッグを実践してみましょう

## 次のステップ

AIツールの使い方を理解したら、[次のセクション](../05-project/README.md)に進んでください。
